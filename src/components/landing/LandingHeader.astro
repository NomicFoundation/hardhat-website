---
import { landing } from "../../config";
import ThemeButton from "./ThemeButton.astro";

const { logo, menu, socials } = landing.header;
---

<header class="header">
  <a href={logo.url} class="logo" aria-label="home page">
    <img src={logo.lightSrc} alt={logo.alt} class="light-logo" />
    <img src={logo.darkSrc} alt={logo.alt} class="dark-logo" />
  </a>

  <nav class="nav" id="nav">
    <ul class="main-menu">
      {
        menu.map((item) => (
          <li class="main-menu-item">
            <a href={item.url} class="main-menu-link">
              {item.label}
            </a>
            {item.dropdown && (
              <ul class="dropdown-menu">
                {item.dropdown.map((dropdownItem) => (
                  <li>
                    <a href={dropdownItem.url} class="dropdown-link">
                      {dropdownItem.label}
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </li>
        ))
      }
    </ul>

    <div class="actions">
      <div class="socials">
        {
          socials.map((social) => (
            <a
              href={social.url}
              class="social-link"
              aria-label={social.name}
              target="_blank"
              rel="noopener noreferrer"
            >
              {social.name === "github" && (
                <svg
                  width="40"
                  height="41"
                  viewBox="0 0 40 41"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M20.0719 6.87405C16.4939 6.87055 13.0315 8.09634 10.3053 10.3318C7.57907 12.5672 5.76716 15.6661 5.19428 19.0732C4.6214 22.4803 5.32499 25.9729 7.17898 28.925C9.03296 31.8771 11.9161 34.0958 15.3118 35.1835C16.0698 35.3173 16.3378 34.8625 16.3378 34.4791C16.3378 34.0957 16.3378 33.2219 16.3378 32.0093C12.1323 32.892 11.245 30.0566 11.245 30.0566C10.966 29.1778 10.3733 28.4228 9.57205 27.9256C8.21336 27.034 9.68297 27.034 9.68297 27.034C10.1592 27.0989 10.614 27.2674 11.0127 27.527C11.4115 27.7865 11.7437 28.1302 11.9844 28.5319C12.1889 28.8896 12.4647 29.2049 12.7958 29.4595C13.1269 29.7142 13.5069 29.9033 13.9139 30.016C14.321 30.1287 14.7471 30.1627 15.1678 30.1161C15.5885 30.0695 15.9955 29.9432 16.3655 29.7445C16.4235 29.011 16.7513 28.3217 17.2898 27.8008C13.9439 27.4352 10.4316 26.1869 10.4316 20.6677C10.4087 19.2259 10.9613 17.8308 11.9752 16.7712C11.5236 15.5176 11.5764 14.1461 12.1231 12.9283C12.1231 12.9283 13.3893 12.5359 16.2639 14.4173C18.7322 13.7635 21.3376 13.7635 23.806 14.4173C26.6805 12.5359 27.9375 12.9283 27.9375 12.9283C28.4918 14.1332 28.5578 15.4949 28.1224 16.7445C29.1363 17.804 29.6889 19.1991 29.666 20.6409C29.666 26.2226 26.1444 27.4441 22.7893 27.774C23.1491 28.1229 23.4269 28.5423 23.6039 29.0038C23.7809 29.4653 23.853 29.9582 23.8152 30.4489C23.8152 32.3927 23.8152 33.962 23.8152 34.4345C23.8152 34.9071 24.0833 35.2727 24.8504 35.13C28.2075 34.0136 31.0475 31.7886 32.8687 28.848C34.69 25.9073 35.3753 22.4404 34.8035 19.0596C34.2318 15.6788 32.4398 12.6017 29.7441 10.372C27.0485 8.14222 23.6227 6.90329 20.0719 6.87405Z"
                  />
                </svg>
              )}
              {social.name === "x" && (
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M16.1758 5.4375H18.4023L13.538 10.9971L19.2605 18.5625H14.7798L11.2704 13.9741L7.25485 18.5625H5.02697L10.2298 12.6159L4.74023 5.4375H9.33466L12.5069 9.63144L16.1758 5.4375ZM15.3944 17.2298H16.6281L8.66427 6.70019H7.34033L15.3944 17.2298Z" />
                </svg>
              )}
              {social.name === "discord" && (
                <svg
                  width="31"
                  height="30"
                  viewBox="0 0 31 30"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_5671_184564)">
                    <path d="M24.4793 6.83103C22.9335 6.11967 21.2748 5.59641 19.5374 5.29545C19.5066 5.28861 19.4759 5.30571 19.4588 5.33307C19.2467 5.71269 19.0073 6.20859 18.8432 6.59847C16.9758 6.31803 15.1188 6.31803 13.2925 6.59847C13.1283 6.20175 12.8821 5.71269 12.6666 5.33307C12.6495 5.30571 12.6188 5.29203 12.588 5.29545C10.854 5.59299 9.19534 6.11625 7.64608 6.82761C7.6324 6.83445 7.62214 6.84471 7.61188 6.85497C4.46549 11.5609 3.60365 16.1471 4.02431 20.6786C4.02431 20.6991 4.03799 20.7231 4.05509 20.7368C6.13103 22.2621 8.1454 23.1889 10.1187 23.8011C10.1495 23.8113 10.1837 23.8011 10.2042 23.7737C10.6728 23.1342 11.0866 22.4639 11.4457 21.7559C11.4662 21.7149 11.4457 21.667 11.4047 21.6499C10.7446 21.4002 10.1153 21.0924 9.50998 20.747C9.4621 20.7197 9.45868 20.6513 9.50314 20.6171C9.62968 20.5213 9.75622 20.4221 9.87934 20.3229C9.89986 20.3058 9.93064 20.3024 9.958 20.3127C13.932 22.1287 18.2344 22.1287 22.1606 20.3127C22.1879 20.299 22.2187 20.3024 22.2392 20.3229C22.3623 20.4221 22.4889 20.5247 22.6154 20.6171C22.6599 20.6513 22.6565 20.7197 22.6086 20.747C22.0032 21.0993 21.374 21.4002 20.7139 21.6499C20.6694 21.667 20.6523 21.7149 20.6729 21.7593C21.0388 22.4673 21.4526 23.1376 21.9109 23.7771C21.9314 23.8045 21.9656 23.8148 21.9964 23.8045C23.98 23.1923 25.991 22.2655 28.0703 20.7402C28.0874 20.7265 28.1011 20.706 28.1011 20.6855C28.6073 15.446 27.2529 10.8974 24.5101 6.86523C24.5033 6.85155 24.493 6.84129 24.4793 6.83787V6.83103ZM12.0408 17.9187C10.8438 17.9187 9.85882 16.8209 9.85882 15.47C9.85882 14.1191 10.8267 13.0212 12.0408 13.0212C13.2549 13.0212 14.2433 14.1293 14.2227 15.47C14.2227 16.8174 13.2549 17.9187 12.0408 17.9187ZM20.1086 17.9187C18.9116 17.9187 17.9266 16.8209 17.9266 15.47C17.9266 14.1191 18.8945 13.0212 20.1086 13.0212C21.3227 13.0212 22.311 14.1293 22.2905 15.47C22.2905 16.8174 21.3329 17.9187 20.1086 17.9187Z" />
                  </g>
                  <defs>
                    <clipPath id="clip0_5671_184564">
                      <rect
                        width="24.282"
                        height="18.509"
                        transform="translate(3.92496 5.29492)"
                      />
                    </clipPath>
                  </defs>
                </svg>
              )}
            </a>
          ))
        }
      </div>

      <ThemeButton size={20} />
    </div>
  </nav>
  <button class="hamburger" id="burger" aria-label="Toggle menu">
    <span></span>
    <span></span>
    <span></span>
  </button>
</header>

<style lang="sass">
  @use '../../styles/mixins' as *
  :global(.menu-open)
    .header
      background-color: var(--hh-neutral0)
      +dark
        background-color: var(--hh-gray900)

      &:after
        content: ""
        position: absolute
        bottom: 1px
        left: 0
        width: 100%
        height: 1px
        background-color: var(--hh-gray200)
        z-index: 11
        pointer-events: none
        +dark
          background-color: var(--hh-gray750)
  .header
    position: sticky
    top: 40px
    z-index: 100
    width: 100%
    display: flex
    align-items: center
    padding: 0 16px
    height: 80px
    background-color: var(--hh-neutral0)

    +dark
      background-color: var(--hh-gray900)

    +tablet
      padding: 0 44px

    +laptop
      padding: 0 32px
      padding-top: 10px
      height: 90px

    &.is-at-top
      background-color: transparent

  .logo
    display: flex
    justify-content: center
    align-items: center
    background-color: transparent
    width: 132px
    margin-right: auto
    +laptop
      width: 165px

    img
      width: 100%

    .light-logo
      display: block
      +dark
        display: none
    .dark-logo
      display: none
      +dark
        display: block

  .nav
    display: flex
    flex-direction: column
    width: min(360px, 100%)
    position: fixed
    top: 120px
    left: 0
    transform: translateX(-100%)
    height: calc(100svh - 120px)
    background-color: var(--hh-neutral0)
    overflow-y: auto
    transition: transform ease-out 0.25s
    z-index: 50
    border-right: 1px solid var(--hh-gray200)
    +dark
      background-color: var(--hh-gray900)
      border-right-color: var(--hh-gray750)
    +laptop
      position: static
      overflow: visible
      flex-direction: row
      z-index: 0
      height: auto
      width: auto
      transform: none
      align-items: center
      gap: 64px
      border: none
      background-color: transparent

    &:global(.is-open)
      transform: translateX(0)

  .main-menu
    display: flex
    flex-direction: column
    list-style: none
    padding: 40px 32px
    gap: 20px
    flex: 1 1 auto
    +laptop
      flex-direction: row
      align-items: center
      gap: 30px
      padding: 0

  .main-menu-item
    position: relative
    +laptop
      padding: 8px 0
    &:hover
      .main-menu-link
        color: var(--hh-violet500) !important

      .dropdown-menu
        opacity: 1
        visibility: visible
        transform: translateX(-50%) translateY(0)

  .main-menu-link
    border: none
    font-size: 20px
    font-weight: 400
    min-height: 33px
    padding: 0 8px
    display: flex
    font-family: var(--font-code)
    align-items: center
    white-space: nowrap
    color: var(--hh-gray700)
    line-height: 1
    letter-spacing: 0.06em
    text-transform: lowercase
    text-decoration: none
    +dark
      color: var(--hh-gray400)
    +laptop

      min-height: 27px
      font-size: 16px
      font-weight: 500

  .dropdown-menu
    display: none

    +dark
      background-color: var(--hh-gray950)
      box-shadow: 0px 0px 6px 0px rgba(74, 77, 84, 0.5)

    +laptop
      display: flex
      flex-direction: column
      gap: 6px
      list-style: none
      position: absolute
      top: calc(100% + 1px)
      left: 50%
      transform: translateX(-50%) translateY(-10px)
      width: 180px
      box-shadow: 0px 0px 6px 0px rgba(210, 211, 213, 0.5)
      background-color: var(--hh-gray100)
      padding: 24px
      opacity: 0
      visibility: hidden
      transition: opacity 0.2s, transform 0.2s, visibility 0.2s
      z-index: 1
      &::before
        content: ""
        position: absolute
        left: 0
        bottom: 100%
        width: 100%
        height: 10px

      &::after
        z-index: 1
        position: absolute
        top: -6px
        left: 50%
        transform: translateX(-50%) rotate(45deg)
        transform-origin: center
        content: " "
        width: 16px
        height: 16px
        background-color: inherit

  .dropdown-link
    display: block
    text-align: center
    line-height: 1.5
    padding: 2px 8px
    font-size: 12px
    font-weight: 500
    color: var(--hh-gray700)
    text-decoration: none
    font-family: var(--font-code)

    +dark
      color: var(--hh-gray400)

    &:hover,
    &:focus-visible
      color: var(--hh-violet500) !important

  .actions
    display: flex
    align-items: center
    gap: 64px
    justify-content: space-between
    padding: 0 40px 16px
    +laptop
      padding: 0

  .socials
    display: flex
    min-width: 80px
    gap: 24px
    height: 32px
    align-items: center
    list-style-type: none
    justify-content: space-between

    +laptop
      display: flex

  .social-link
    display: flex
    align-items: center
    justify-content: center

    svg
      fill: var(--hh-gray400)
      width: 24px
      height: 24px
      +laptop
        width: 32px
        height: 32px

      +dark
        fill: var(--hh-gray600)

    &:hover svg,
    &:focus svg
      cursor: pointer
      fill: var(--hh-gray600)

      +dark
        fill: var(--hh-gray400)

  .hamburger
    width: 24px
    height: 24px
    display: flex
    flex-direction: column
    justify-content: space-between
    padding: 4px
    border: none
    background-color: transparent
    cursor: pointer

    +laptop
      display: none

    span
      background-color: var(--hh-neutral900)
      height: 1px
      width: 17px
      transform-origin: left
      user-select: none
      transition: all 0.25s ease-in-out

      +dark
        background-color: var(--hh-neutral0)

      &:nth-child(2)
        transition: all 0.1s ease-out

    &:global(.is-active)
      span
        width: 23px

        &:nth-child(1)
          transform: rotate(45deg) translate(-1px, -1px)

        &:nth-child(2)
          opacity: 0

        &:nth-child(3)
          transform: rotate(-45deg) translate(0, 0px)
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const header = document.querySelector<HTMLElement>(".header");
    const hamburger = document.getElementById("burger");
    const nav = document.getElementById("nav");
    const body = document.body;

    const toggleHeaderClass = () => {
      const isAtTop = window.scrollY === 0;
      header?.classList.toggle("is-at-top", isAtTop);
    };

    const toggleMenu = (isOpen: boolean) => {
      nav?.classList.toggle("is-open", isOpen);
      hamburger?.classList.toggle("is-active", isOpen);
      body.classList.toggle("menu-open", isOpen);
    };

    const closeMenu = () => toggleMenu(false);

    hamburger?.addEventListener("click", (e) => {
      e.stopPropagation();
      const isOpen = nav?.classList.contains("is-open");
      toggleMenu(!isOpen);
    });

    document.addEventListener("click", (e) => {
      const target = e.target as HTMLElement;
      const clickedOutside =
        !nav?.contains(target) && !hamburger?.contains(target);

      if (clickedOutside) closeMenu();
    });

    window.addEventListener("scroll", toggleHeaderClass);
    toggleHeaderClass();
  });
</script>
